{"version":3,"sources":["../src/index.js"],"names":["context","document","querySelector","source","control","autoPlay","autoClose","orientation","aspectRatio","options","wrapper","video","mask","playButton","createElement","_addStyles","position","left","top","right","bottom","margin","width","minWidth","height","minHeight","backgroundColor","zIndex","overflow","innerHTML","objectFit","objectPosition","appendChild","contains","eventBind","play","addEventListener","_isPlaying","pause","console","log","_showPlayBtn","_remove","_hiddenPlayBtn","style","display","currentTime","paused","ended","readyState","removeChild","element","styles","name"],"mappings":"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","file":"index.js","sourcesContent":["export default class {\r\n  /**\r\n   * @param context\r\n   * @param source\r\n   * @param control\r\n   * @param autoPlay\r\n   * @param autoClose\r\n   * @param orientation\r\n   * @param aspectRatio\r\n   */\r\n  constructor({\r\n                context = document.querySelector('body'),\r\n                source,\r\n                control = false,\r\n                autoPlay = true,\r\n                autoClose = true,\r\n                orientation = 'portrait',\r\n                aspectRatio = 9 / 16,\r\n              }) {\r\n    this.context = context;\r\n    this.options = {\r\n      source: source,\r\n      control: control,\r\n      autoPlay: autoPlay,\r\n      autoClose: autoClose,\r\n      orientation: orientation,\r\n      aspectRatio: aspectRatio,\r\n    };\r\n\r\n    this.wrapper = null;\r\n    this.video = null;\r\n    this.mask = null;\r\n    this.playButton = null;\r\n  };\r\n\r\n  init() {\r\n    // wrapper\r\n    this.wrapper = document.createElement('div');\r\n    _addStyles(this.wrapper, {\r\n      position: 'absolute',\r\n      left: '-100%',\r\n      top: '-100%',\r\n      right: '-100%',\r\n      bottom: '-100%',\r\n      margin: 'auto',\r\n      width: '100vw',\r\n      minWidth: 100 * this.options.aspectRatio + 'vh',\r\n      height: 100 / this.options.aspectRatio + 'vw',\r\n      minHeight: '100vh',\r\n      backgroundColor: 'black',\r\n      zIndex: '9999',\r\n      overflow: 'hidden',\r\n    });\r\n\r\n    this.wrapper.innerHTML = `\r\n      <video width=\"100%\" src=${this.options.source} preload x-webkit-airplay=\"allow\" webkit-playsinline=\"true\" playsinline x5-video-player-type=\"h5\" x5-video-player-fullscreen=\"true\" x5-video-orientation=${this.options.orientation}></video>\r\n      <div></div>\r\n    `;\r\n\r\n    // video\r\n    this.video = this.wrapper.querySelector('video');\r\n    _addStyles(this.video, {\r\n      position: 'absolute',\r\n      left: '0',\r\n      top: '0',\r\n      width: '100%',\r\n      height: '100%',\r\n      zIndex: '-1',\r\n      objectFit: 'fill',\r\n      objectPosition: '50% 50%',\r\n    });\r\n\r\n    // mask\r\n    this.mask = this.wrapper.querySelector('div');\r\n    _addStyles(this.mask, {\r\n      position: 'absolute',\r\n      left: '0',\r\n      top: '0',\r\n      width: '100%',\r\n      height: '100%',\r\n      zIndex: '10',\r\n    });\r\n\r\n    // playButton\r\n    if (this.options.control) {\r\n      this.playButton = document.createElement('div');\r\n      _addStyles(this.playButton, {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0',\r\n        width: '100%',\r\n        height: '100%',\r\n        zIndex: '100',\r\n        backgroundColor: 'rgba(0, 0, 0, .1)',\r\n      });\r\n\r\n      this.playButton.innerHTML = `\r\n        <div style=\"position: absolute; left: 0; top: 0; right: 0; bottom: 0; margin: auto; max-width: 60px; max-height: 60px; cursor: pointer; opacity: .6;\">\r\n          <svg viewBox=\"0 0 64 64\" style=\"max-width: 60px; max-height: 60px; fill: #fff;\">\r\n            <path d=\"M26,45.5L44,32L26,18.6v27V45.5L26,45.5z M32,2C15.4,2,2,15.5,2,32c0,16.6,13.4,30,30,30c16.6,0,30-13.4,30-30 C62,15.4,48.5,2,32,2L32,2z M32,56c-9.7,0-18.5-5.9-22.2-14.8C6.1,32.2,8.1,21.9,15,15c6.9-6.9,17.2-8.9,26.2-5.2 C50.1,13.5,56,22.3,56,32C56,45.3,45.2,56,32,56L32,56z\"/>\r\n          </svg>\r\n        </div>\r\n      `;\r\n\r\n      this.wrapper.appendChild(this.playButton);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  load() {\r\n    if (!this.context.contains(this.wrapper)) {\r\n      this.context.appendChild(this.wrapper);\r\n    }\r\n\r\n    this.eventBind();\r\n\r\n    if (this.options.autoPlay) {\r\n      this.play();\r\n    }\r\n  };\r\n\r\n  eventBind() {\r\n    if (this.options.control) {\r\n      this.mask.addEventListener('click', () => {\r\n        if (this._isPlaying()) {\r\n          this.pause();\r\n        } else {\r\n          this.play();\r\n        }\r\n      });\r\n\r\n      this.playButton.addEventListener('click', () => {\r\n        this.play();\r\n      });\r\n    }\r\n\r\n    this.video.addEventListener('ended', () => {\r\n      console.log('ended');\r\n      this._showPlayBtn();\r\n      if (this.options.autoClose) {\r\n        this._remove();\r\n      }\r\n    });\r\n  };\r\n\r\n  play() {\r\n    this.video.play();\r\n    this._hiddenPlayBtn();\r\n  };\r\n\r\n  pause() {\r\n    this.video.pause();\r\n    this._showPlayBtn();\r\n  };\r\n\r\n  _showPlayBtn() {\r\n    if (this.playButton) {\r\n      this.playButton.style.display = 'block';\r\n    }\r\n  }\r\n\r\n  _hiddenPlayBtn() {\r\n    if (this.playButton) {\r\n      this.playButton.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  _isPlaying() {\r\n    return this.video.currentTime > 0 && !this.video.paused && !this.video.ended\r\n      && this.video.readyState > 2;\r\n  };\r\n\r\n  _remove() {\r\n    this.context.removeChild(this.wrapper);\r\n  };\r\n};\r\n\r\n// private\r\nlet _addStyles = (element, styles) => {\r\n  for (let name in styles) {\r\n    element.style[name] = styles[name];\r\n  }\r\n};\r\n"]}